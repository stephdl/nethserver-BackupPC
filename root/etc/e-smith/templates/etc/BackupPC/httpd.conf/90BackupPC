{
use NethServer::Password;
my $pwd = NethServer::Password::store('libuser');
my $cgimultiuser = ${backuppc}{CgiMultiUser} || 'enabled';

$OUT .=<<"HERE";
Alias           /BackupPC/images        /usr/share/BackupPC/html/
ScriptAlias     /BackupPC               /usr/share/BackupPC/sbin/BackupPC_Admin

Alias           /backuppc/images        /usr/share/BackupPC/html/
ScriptAlias     /backuppc               /usr/share/BackupPC/sbin/BackupPC_Admin

<Directory /usr/share/BackupPC/html/>
    Options None
    AllowOverride None
    order deny,allow
    deny from all
    allow from 127.0.0.1
</Directory>

<Directory /usr/share/BackupPC/sbin/>
        Options ExecCGI
        AllowOverride None
        order deny,allow
        deny from all
        allow from 127.0.0.1
        AuthName "BackupPC"
        AuthType Basic
        AuthBasicProvider ldap
        AuthLDAPBindDN cn=libuser,dc=directory,dc=nh
        AuthLDAPBindPassword $pwd
        AuthLDAPURL "ldap://localhost/ou=People,dc=directory,dc=nh?uid?sub?(objectClass=posixAccount)"
HERE

if ($cgimultiuser eq 'enabled') {
    $OUT .='        require valid-user\n';
}

else {
    $OUT .='        require user admin\n';
}
$OUT .=<<"HERE";
        Satisfy all
</Directory>
HERE
}
